= Starting a new Camel K Route

Useful place to start for any new Camel K integration project.

== Prerequisites

++++
<a href='didact://?commandId=vscode.didact.validateAllRequirements' title='Validate all requirements!'><button>Validate all Requirements at Once!</button></a>
<p/>
++++

[options="header"]
|===========================
| Requirement (Click to Verify)  | Status | Additional Information/Solution
| link:didact://?commandId=vscode.didact.cliCommandSuccessful&text=kamel-status$$kamel[Is Kamel available?] | ++++<em id="kamel-status">Status: unknown</em>++++ 	| link:https://camel.apache.org/camel-k/[Check the Apache Camel K documentation for details]
| link:didact://?commandId=vscode.didact.extensionRequirementCheck&text=extension-requirement-status$$redhat.apache-camel-extension-pack[VS Code Extension Pack for Apache Camel by Red Hat is installed] | ++++<em id="extension-requirement-status">Status: unknown</em>++++ | link:vscode:extension/redhat.vscode-camelk[Click here to install]
|===========================

[time=10]
== Create a simple Camel K route and start it running

=== Step 1: Creating a Folder with your Java Integration

First, we need to set up our sample project. Camel K has many examples available at their link:https://github.com/apache/camel-k/tree/master/examples[GitHub project hosting the source], but we're just going to use the simplest one: `simple.groovy`.

You can download the file yourself from the GitHub repo and then copy it into a folder in your workspace called `helloworld-camelk-integration` or use link:didact://?commandId=vscode.didact.scaffoldProject&extFilePath=redhat.vscode-camelk/didact/camelk/helloworld-java-project.json[this link].

You will end up with a structure like this:

....
- helloworld-camelk-integration
  - src
      HelloWorld.java
....

=== Step 2: Exploring the Java Integration file

Now that you have an integration file, let's take a quick look at it. If you created the file yourself, go ahead and open it now. Go to the Explorer activity (Ctrl+Shift+E) and look at the workspace folders listed.

If you clicked the link to create the sample project, you can find it in `helloworld-camelk-integration/src/HelloWorld.java` in the Explorer view.

* Note: If you have the `helloworld-camelk-integration` project in your workspace, you can open the HelloWorld.java file in the editor with link:didact://?commandId=vscode.openFolder&projectFilePath=helloworld-camelk-integration/src/HelloWorld.java[this link].

For this file, we're simply telling Camel to put the message `Hello Camel K from ${routeId}` in the console once every second.

=== Step 3: Deploying the Integration

image:https://raw.githubusercontent.com/camel-tooling/vscode-camelk/master/images/camelk-start-integration-popup-menu.jpg[Camel K Start Integration menu,224,235,role="right"]

The `Tooling for Camel K` extension offers several tools to get your new integration started. 

First, you can right-click the `HelloWorld.java` file and select `Start Apache Camel K Integration`. That will provide a drop-down in the Command palette area with a number of deployment options. In this case, select the `Dev Mode - Apache Camel K Integration in Dev Mode` option. 

* Note: link:didact://?commandId=camelk.startintegration&projectFilePath=helloworld-camelk-integration/src/HelloWorld.java[Click here to see the drop-down and select the mode you want to start the integration in]
* Note: link:didact://?commandId=camelk.startintegration&projectFilePath=helloworld-camelk-integration/src/HelloWorld.java&text=Dev%20Mode[Click here to start the HelloWorld.java integration in Dev Mode]

Since this is likely the first time you've started a new integration in Camel K, it might take a bit to spin up the necessary resources on the target system. While that starts up, we can look at the `Apache Camel K` Output channel and watch as the Camel K operator starts up the necessary resources to run our integration.

When your route finishes deploying, you will begin to see messages showing up in the log window. 

....
...
[1] 2020-04-14 20:54:29.993 [32mINFO [m [main] AbstractCamelContext - Route: java started and consuming from: timer://java
[1] 2020-04-14 20:54:29.997 [32mINFO [m [main] AbstractCamelContext - Total 1 routes, of which 1 are started
[1] 2020-04-14 20:54:29.997 [32mINFO [m [main] AbstractCamelContext - Apache Camel 3.1.0 (CamelContext: camel-k) started in 0.126 seconds
[1] 2020-04-14 20:54:29.998 [32mINFO [m [main] ApplicationRuntime - Listener org.apache.camel.k.listener.RoutesDumper@245b4bdc executed in phase Started
[1] 2020-04-14 20:54:31.039 [32mINFO [m [Camel (camel-k) thread #2 - timer://java] info - Exchange[ExchangePattern: InOnly, BodyType: String, Body: Hello Camel K from java]
[1] 2020-04-14 20:54:31.995 [32mINFO [m [Camel (camel-k) thread #2 - timer://java] info - Exchange[ExchangePattern: InOnly, BodyType: String, Body: Hello Camel K from java]
[1] 2020-04-14 20:54:32.996 [32mINFO [m [Camel (camel-k) thread #2 - timer://java] info - Exchange[ExchangePattern: InOnly, BodyType: String, Body: Hello Camel K from java]
...
....

== Step 4: Updating the Integration

While our integration is running in `Dev Mode`, we can modify it and see those changes reflected in the deployed integration. Let's try that now.

Change the message sent to the `.simple()` command of the Camel route in quotes to `We just changed our first Camel K integration while it was running!`. 

Save the file and see what happens in the Output channel.

== Step 5: Managing our Integration

We can see what integrations we currently have running in our Minikube system in the `Apache Camel K Integrations` view in the Explorer activity (Ctrl+Shift+E).

* Open the `Apache Camel K Integrations` view

image:https://raw.githubusercontent.com/camel-tooling/vscode-camelk/master/images/camelk-integrations-view-remove-menu.jpg[Integrations view with context menu,role="right"]

From here, we can:

* Hover over the `Apache Camel K Integrations` view and click the `Open Apache Camel K Operator Log` button to view it.
* Hover over the integration name to see its current state in the tooltip. 
* Right-click on the running integration to `Remove Apache Camel K Integration` and undeploy it.
* Right-click on the running integration to `Follow log for running Apache Camel K Integration`
* Right-click on the running integration to `Follow kit builder log for running Apache Camel K integration`

While we are running in `Dev Mode`, all our logged output goes to the main `Apache Camel K` Output channel, but if the integration is running in another mode (such as `Basic`), we can explicitly open a new Output channel to follow the log for that running integration.

* To open a separate log window for your route, right-click on the deployed integration 'hello-world' in the `Apache Camel K Integrations` view and select `Follow log for running Apache Camel K integration`. 

== Did it work? 

You should see your Camel route injecting a new message in the log every few seconds.

== Did it not work?

Remove the simple directory and try the steps again. If it's still not working:

. Validate that you have access to the Apache Camel K CLI (via terminal or via command)
. Check if something went wrong when starting the integration. View the Apache Camel K Operator log from the view toolbar or Kit Builder log avaialble when you right-click the integration

== Finding more information

For more about **Apache Camel K**, link:https://camel.apache.org/camel-k/latest/index.html[check out the project documentation].

For more about what the **Tooling for Apache Camel K** extension has to offer in VS Code, link:https://github.com/camel-tooling/vscode-camelk/blob/master/README.md[check out the readme].
